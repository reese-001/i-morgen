<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" href="../styles.css">
		<title>i morgen</title>
		<link rel="icon" href="../images/logo.png">
	</head>
	<body>
		<table width="80%">
			<tr>
				<td width="5%"><img src="../images/logo.png" class="logo"></td>
				<td width="80%"><h1 style="color:hsl(241, 74%, 46%)">i morgen</h1></td>
				
			</tr>
		</table>
        <h2 style="color:#0A45A5;"><a href="../../index.html">home</a>:<a href="../../aws/aws.html">aws</a>:<a href="index.html">elb</a>:overview</h2>

        <p><span style="font-size: 20px;"><strong>ELB (Elastic Load Balancer)</strong></span></p>

		<p><span style="font-size: 18px;"><strong>Contents</strong></span></p>
		<ul>
			<li><a href="#what_is_it">What is it</a></li>
			<li><a href="#types_of_elb">Types of ELB</a></li>
			<li><a href="#rules_of_traffic">Rules of Traffic</a></li>
			<li><a href="#sticky_sessions">Sticky Sessions</a></li>
			<li><a href="#xff">XFF</a></li>
			<li><a href="#health_checks">Health Checks</a></li>
			<li><a href="#cross_zone_balancing">Cross Zone Balancing</a></li>
			<li><a href="#request_routing">Request Routing</a></li>
		</ul>

		<div id="what_is_it"><p><span style="font-size: 18px;"><strong>What is it?</strong></span></p></div>
		<ul>
			<li>A load balancer distributes incoming application traffic across multiple EC2 instances in multiple Availability Zones</li>
			<li>Benefit: increases the fault tolerance of your applications by detecting unhealthy instances and routes traffic only to healthy instances.</li>
			<li>ELB can automatically scale to almost any workload</li>
			<li>Load between targets is defined by rules and vary based on types of load balancer</li>
			</ul>

		<div id="types_of_elb"><p><span style="font-size: 18px;"><strong>Types of ELB</strong></span></p></div>
		<ul>
			<li>There are three types available</li>
			<ol>
				<li>Application Load Balancer (ALB) </li>
				<ul>
					<li>Used for HTTP/HTTPS </li>
					<li>Layer 7 of <a href="../images/elb_osi_model.png">OSI Model</a></li>
					<li>ALB logs can capture latency and incoming IP addresses</li> 
					<li>Use case: web sites</li>
					<li><a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/introduction.html" target="_blank">AWS link</a></li>
				</ul>
				<li>Network Load Balancer (NLB)</li>
				<ul>
					<li>Used for TCP/UDP</li>
					<li>Layer 4 of <a href="../images/elb_osi_model.png">OSI Model</a></li>
					<li>Able to handle millions of requests per second</li>
					<li>Can handle cross zone load balancing</li>
					<li>Use case: multi player games</li>
					<li><a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/network/introduction.html" target="_blank">AWS link</a></li>
				</ul>
				<li>Classic Load Balancer (CLB)</li>
				<ul>
					<li><a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/classic/introduction.html" target="_blank">AWS link</a></li>
					<li>Traffic is sent to listeners. If the port matches it forwards to EC2. No rules allowed. </li>
					<li>Can handle HTTP, HTTPS, TCP traffic but not at the same time</li>
					<li>Will respond with 504 error (timeout) if underlying application is not responding (web server/db level)</li>
					<li><a href="../images/elb_classic_load_balancer.png">Illustration (ExamPro)</a></li>
					<li>Legacy</li>
				</ul>
			</ol>
		</ul>

		<div id="rules_of_traffic"><p><span style="font-size: 18px;"><strong>Rules of Traffic</strong></span></p></div>	
		<ul>
			<li>Three components involved in flow of traffic</li>
			<ul>
				<li>Listeners</li>
				<ul>
					<li>Listeners evaluate all traffic that matches the listeners port</li>
					<li>For Classic Load Balancer, EC2 instances are directly registered to the Load Balancer</li>
				</ul>
				<li>Rules</li>
				<ul>
					<li>Listeners will invoke rules to decide what to do with the traffic and forward traffic to target groups</li>
				</ul>
				<li>Target Groups</li>
				<ul>
					<li>EC2 instances are registered as targets to a Target Group</li>
				</ul>
				
			</ul>
		</ul>

		
		<div id="sticky_sessions"><p><span style="font-size: 18px;"><strong>Sticky Sessions</strong></span></p></div>
		<ul>
			<li>Allows you to bind a users session to a specific EC2 instance</li>
			<li>Useful for applications that store session data on the instance</li>
			<li>Used only on ALB an Classic (not NLB)</li>
			
			<ul>
				<li>In the case of ALB, it can only be set on target group, not EC2</li>
			</ul>
			<li>Can be used with cookies or source IP</li>
		</ul>
        
		<div id="xff"><p><span style="font-size: 18px;"><strong>X-Forwarded-For (XFF) Header</strong></span></p></div>
		<ul>
			<li>When a request is forwarded to an EC2 instance, the XFF header is added to the request</li>
			<li>Contains the IP address of the client that initiated the request</li>
			<li>Useful for logging and debugging</li>
			<li><a href="../images/elb_xff.png">Illustration (ExamPro)</a></li>
		</ul>

		<div id="health_checks"><p><span style="font-size: 18px;"><strong>Health Checks</strong></span></p></div>
		<ul>
			<li>To maintain the same number of instances, Amazon EC2 Auto Scaling performs a periodic health check on running instances within an Auto Scaling group.</li>
			<li>When it finds that an instance is unhealthy, it terminates that instance and launches a new one</li>
			<li>Amazon EC2 Auto Scaling creates a new scaling activity for terminating the unhealthy instance and then terminates it.</li>
			<li>Later, another scaling activity launches a new instance to replace the terminated instance.</li>
			<li>References</li>
			<ul>
				<li><a href="https://aws.amazon.com/premiumsupport/knowledge-center/auto-scaling-terminate-instance/" target="_blank">Why didnâ€™t Amazon EC2 Auto Scaling terminate an unhealthy instance?</a></li>
				<li><a href="https://docs.aws.amazon.com/autoscaling/ec2/userguide/as-maintain-instance-levels.html#replace-unhealthy-instance" target="_blank">Maintain a fixed number of instances in your Auto Scaling group</a></li>
				<li><a href="https://docs.aws.amazon.com/autoscaling/ec2/userguide/healthcheck.html" target="_blank">Health Checks for Auto Scaling Instances</a></li>
			</ul>
		</ul>

		<div id="cross_zone_balancing"><p><span style="font-size: 18px;"><strong>Cross Zone Balancing</strong></span></p></div>	
		<ul>
			<li>Only available on Classic and NLB</li>
			<li>When enabled requests are evenly distributed across the instances in all enabled AZ's</li>
			<li>When disabled requests are evenly distributed across the instances in only the AZ</li>
			<li><a href="../images/elb_cross_zone_balancing.png">Illustration (ExamPro)</a></li>
			<li>Example of traffic distribution: </li>
			<ul>
				<li>An organiztion has hosted its EC2 instances in two AZ's. AZ1 has two instances and AX2 has 8 inctances. ELB has cross zone load balancing enabled. What percent of traffic will each instance in AZ1 receive</li>
				<ul>
					<li>With cross-zone load balancing enabled, the Elastic Load Balancer will distribute traffic evenly across all of the registered instances in the two AZs.</li>
					<li>This means that each instance in AZ1 will receive 1/10th (10% or 10/100) of the total traffic</li>
				</ul>
			</ul>
		</ul>

		<div id="request_routing"><p><span style="font-size: 18px;"><strong>Request Routing</strong></span></p></div>	
		<ul>
			<li>Apply rules to incoming requests and then forward or redirect traffic</li>
			<li>Rules can be based on the following</li>
			<li><a href="https://aws.amazon.com/blogs/aws/new-advanced-request-routing-for-aws-application-load-balancers/">AWS documentation</a></li>
			<li><a href="https://aws.amazon.com/elasticloadbalancing/pricing/">Pricing</a></li>
			<ul>
				<li>Host header</li>
				<li>Source IP</li>
				<li>Path</li>
				<li>Http header</li>
				<li>Http header method</li>
				<li>Query string</li>
			</ul>
			<li>Actions taken can consist of</li>
			<ul>
				<li>Forward to</li>
				<li>Redirect to</li>
				<li>Return fixed response</li>
				<li>Authenticate</li>
			</ul>

		</ul>

    </body>
</html>